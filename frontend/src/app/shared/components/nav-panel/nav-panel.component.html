<div class="bg-base-200 flex flex-col h-full rounded-lg overflow-hidden text-content-200">
  <div class="p-4 flex items-center justify-between border-b border-base-300">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 flex-shrink-0 bg-brand-primary rounded-full flex items-center justify-center">
        <i class="pi pi-comment text-xl text-brand-500"></i>
      </div>
      <h1 class="text-xl font-bold text-content-100">FinEd Mentor</h1>
    </div>
  </div>

  <div class="p-2 space-y-2">
    <button (click)="onNewChat()"
      class="w-full flex items-center justify-between px-3 py-2 text-sm font-medium rounded-md bg-brand-500 text-alien-primary hover:bg-brand-700 transition-colors">
      New Chat
      <i class="pi pi-plus text-xl"></i>
    </button>

    <button (click)="onShowDashboard()"
      [class]="currentView === 'dashboard' ? 
               'w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md bg-base-300 text-content-100 transition-colors' :
               'w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md hover:bg-base-300/50 transition-colors'">
      <i class="pi pi-chart-bar text-xl"></i>
      Dashboard
    </button>
  </div>

  <div class="flex-1 overflow-y-auto p-2">
    <h3 class="px-3 text-xs font-semibold uppercase text-gray-500 tracking-wider mb-2">Chat History</h3>
    <div class="space-y-1">
      <div *ngFor="let session of sortedSessions"
        [class]="isSessionActive(session.id) ? 
                 'group flex items-center justify-between w-full px-3 py-2 text-sm text-left font-medium rounded-md cursor-pointer bg-base-300 text-content-100 transition-colors' :
                 'group flex items-center justify-between w-full px-3 py-2 text-sm text-left font-medium rounded-md cursor-pointer hover:bg-base-300/50 transition-colors'">

        <!-- Normal View -->
        <div *ngIf="!isEditing(session.id)" class="flex items-center justify-between w-full"
          (click)="onSelectSession(session.id)">
          <span class="truncate flex-1">{{ session.title }}</span>
          <div class="flex items-center gap-1 ml-2">
            <button (click)="startEditTitle($event, session.id, session.title)"
              class="p-1 rounded-full text-gray-500 hover:bg-blue-500/20 hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity"
              aria-label="Edit title">
              <i class="pi pi-pencil text-base"></i>
            </button>
            <button (click)="openDeleteModal($event, session.id)"
              class="p-1 rounded-full text-gray-500 hover:bg-red-500/20 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity"
              aria-label="Delete chat">
              <i class="pi pi-trash text-base"></i>
            </button>
          </div>
        </div>

        <!-- Edit View -->
        <div *ngIf="isEditing(session.id)" class="flex items-center gap-2 w-full" (click)="$event.stopPropagation()">
          <input type="text" [(ngModel)]="editedTitle" (keydown.enter)="saveTitle($event, session.id)"
            (keydown.escape)="cancelEdit()"
            class="flex-1 px-2 py-1 text-sm bg-base-100 border border-base-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 text-content-100"
            placeholder="Enter title" autofocus>
          <button (click)="saveTitle($event, session.id)"
            class="p-1 rounded-full text-green-500 hover:bg-green-500/20 transition-colors" aria-label="Save">
            <i class="pi pi-check text-base"></i>
          </button>
          <button (click)="cancelEdit()" class="p-1 rounded-full text-red-500 hover:bg-red-500/20 transition-colors"
            aria-label="Cancel">
            <i class="pi pi-times text-base"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- User Info Section -->
  <div class="p-4 border-t border-base-300 flex items-center justify-between">
    <div class="flex items-center gap-3">
      <div class="w-10 h-10 bg-gray-400 rounded-full flex items-center justify-center text-white font-bold">
        <span>{{ userName.charAt(0).toUpperCase() }}</span>
      </div>
      <div>
        <p class="text-sm font-medium text-content-100">{{ userName }}</p>
      </div>
    </div>
    <button class="p-2 rounded-full hover:bg-base-300 transition-colors relative" aria-label="User options"
      (click)="toggleMenu()">
      <i class="pi pi-ellipsis-v text-xl text-content-200"></i>

      <!-- Popup Menu -->
      <div *ngIf="isMenuOpen"
        class="absolute top-0 right-0 transform -translate-y-full mt-2 w-48 bg-base-200 rounded-lg shadow-lg z-10 border border-base-300">
        <ul class="py-2">
          <li class="px-4 py-2 hover:bg-base-300 cursor-pointer flex items-center gap-2" (click)="closeMenu()">
            <i class="pi pi-cog text-content-100"></i> <span
              class="text-sm font-medium text-content-100">Settings</span>
          </li>
          <li class="px-4 py-2 hover:bg-base-300 cursor-pointer flex items-center gap-2" (click)="closeMenu()">
            <i class="pi pi-envelope text-content-100"></i> <span
              class="text-sm font-medium text-content-100">Contact</span>
          </li>
          <li class="px-4 py-2 hover:bg-red-500/20 text-red-500 cursor-pointer flex items-center gap-2"
            (click)="onLogout()">
            <i class="pi pi-sign-out text-red-500"></i> <span class="text-sm font-medium">Log out</span>
          </li>
        </ul>
      </div>
    </button>
  </div>
</div>

<app-confirm-dialog [isOpen]="isDeleteModalOpen" [title]="deleteModalTitle" [message]="deleteModalMessage"
  confirmText="Delete" cancelText="Cancel" [isDestructive]="true" (confirm)="onConfirmDelete()"
  (cancel)="onCancelDelete()">
</app-confirm-dialog>