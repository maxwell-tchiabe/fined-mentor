<div class="bg-base-200 flex flex-col h-full rounded-lg overflow-hidden text-content-200 shadow-xl">
  <div class="p-4 flex items-center justify-between border-b border-base-300">
    <div class="flex items-center gap-2">
      <img src="assets/logo.svg" alt="" class="w-10 h-10" aria-hidden="true">
      <h1 class="text-xl font-bold text-content-100">{{ 'APP_NAME' | translate }}</h1>
    </div>
  </div>

  <div class="p-2 space-y-4 bg-base-300/30 border-b border-base-300">
    <div class="space-y-2">
      <button (click)="onNewChat()"
        class="w-full flex items-center justify-between px-3 py-2 text-sm font-medium rounded-md bg-brand-500 text-content-100 hover:bg-brand-700 transition-all duration-200 shadow-lg shadow-brand-500/20 active:scale-[0.98]">
        {{ 'NAV.NEW_CHAT' | translate }}
        <i class="pi pi-plus text-lg"></i>
      </button>

      <button (click)="onShowDashboard()"
        [class]="currentView === 'dashboard' ? 
                 'w-full flex items-center gap-3 px-3 py-2 text-sm font-semibold rounded-md bg-base-300 text-brand-400 border border-brand-500/30 shadow-inner dashboard-active' :
                 'w-full flex items-center gap-3 px-3 py-2 text-sm font-medium rounded-md hover:bg-base-300/50 text-content-200 hover:text-content-100 transition-all'">
        <i class="pi pi-chart-bar text-xl"></i>
        {{ 'NAV.DASHBOARD' | translate }}
      </button>
    </div>
  </div>

  <!-- History Header -->
  <div
    class="px-5 py-3 flex items-center gap-2 text-[10px] font-black uppercase text-brand-400 items-center tracking-[0.2em] opacity-80">
    <i class="pi pi-history text-xs"></i>
    <span>{{ 'NAV.HISTORY' | translate }}</span>
  </div>

  <div class="flex-1 overflow-y-auto p-2 pt-0 scrollbar-none">
    <div *ngFor="let group of sessionGroups" class="mb-4">
      <h3
        class="sticky top-0 z-10 px-3 py-2 text-[10px] font-bold uppercase text-content-300 tracking-[0.1em] bg-base-200/95 backdrop-blur-sm mb-1">
        {{ group.label }}
      </h3>

      <div class="space-y-1">
        <div *ngFor="let session of group.sessions"
          [class]="isSessionActive(session.id) ? 
                   'group flex items-center justify-between w-full px-3 py-2 text-sm text-left font-medium rounded-md cursor-pointer bg-base-300 text-content-100 transition-colors shadow-sm' :
                   'group flex items-center justify-between w-full px-3 py-2 text-sm text-left font-medium rounded-md cursor-pointer hover:bg-base-300/50 text-content-200 hover:text-content-100 transition-colors'">

          <!-- Normal View -->
          <div *ngIf="!isEditing(session.id)" class="flex items-center justify-between w-full"
            (click)="onSelectSession(session.id)">
            <span class="truncate flex-1">{{ session.title }}</span>
            <div class="flex items-center gap-1 ml-2">
              <button (click)="startEditTitle($event, session.id, session.title)"
                class="p-1 rounded-full text-gray-500 hover:bg-blue-500/20 hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-all duration-200"
                aria-label="Edit title">
                <i class="pi pi-pencil text-base"></i>
              </button>
              <button (click)="openDeleteModal($event, session.id)"
                class="p-1 rounded-full text-gray-500 hover:bg-red-500/20 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-all duration-200"
                aria-label="Delete chat">
                <i class="pi pi-trash text-base"></i>
              </button>
            </div>
          </div>

          <!-- Edit View -->
          <div *ngIf="isEditing(session.id)" class="flex items-center gap-2 w-full" (click)="$event.stopPropagation()">
            <input type="text" [(ngModel)]="editedTitle" (keydown.enter)="saveTitle($event, session.id)"
              (keydown.escape)="cancelEdit()"
              class="flex-1 px-2 py-1 text-sm bg-base-100 border border-base-300 rounded-md focus:outline-none focus:ring-2 focus:ring-brand-500 text-content-100 shadow-inner"
              placeholder="Enter title" autofocus>
            <button (click)="saveTitle($event, session.id)"
              class="p-1 rounded-full text-green-500 hover:bg-green-500/20 transition-colors" aria-label="Save">
              <i class="pi pi-check text-base"></i>
            </button>
            <button (click)="cancelEdit()" class="p-1 rounded-full text-red-500 hover:bg-red-500/20 transition-colors"
              aria-label="Cancel">
              <i class="pi pi-times text-base"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- User Info Section -->
  <div
    class="p-3 border-t border-base-300 flex items-center justify-between hover:bg-base-300/30 transition-all cursor-pointer rounded-b-lg group"
    (click)="toggleMenu()">
    <div class="flex items-center gap-3">
      <div
        class="w-10 h-10 bg-gradient-to-br from-brand-400 to-brand-600 rounded-full flex items-center justify-center text-white font-bold shadow-md transform group-hover:scale-105 transition-transform">
        <span>{{ userName.charAt(0).toUpperCase() }}</span>
      </div>
      <div class="flex flex-col">
        <p
          class="text-sm font-semibold text-content-100 group-hover:text-brand-400 transition-colors truncate max-w-[140px]">
          {{ userName }}</p>
        <p class="text-[10px] text-content-300 uppercase tracking-wider font-bold opacity-60">Verified Member</p>
      </div>
    </div>
    <div class="p-2 rounded-full hover:bg-base-300 transition-colors relative" aria-label="User options">
      <i class="pi pi-ellipsis-v text-xl text-content-200 group-hover:text-content-100"></i>

      <!-- Popup Menu -->
      <div *ngIf="isMenuOpen" (click)="$event.stopPropagation()"
        class="absolute bottom-full right-0 mb-2 w-48 bg-base-200 rounded-lg shadow-xl z-20 border border-base-300 overflow-hidden">
        <ul class="py-1">
          <!-- <li class="px-4 py-2.5 hover:bg-base-300 cursor-pointer flex items-center gap-3 transition-colors"
            (click)="closeMenu()">
            <i class="pi pi-cog text-content-200"></i> <span class="text-sm font-medium text-content-100">{{
              'NAV.SETTINGS' | translate }}</span>
          </li> -->
          <li class="px-4 py-2.5 hover:bg-base-300 flex items-center justify-between gap-3 transition-colors">
            <div class="flex items-center gap-3 min-w-0">
              <i class="pi pi-globe text-content-200 shrink-0"></i>
              <span class="text-sm font-medium text-content-100 truncate">{{ 'SETTINGS.LANGUAGE' | translate }}</span>
            </div>
            <app-language-switcher class="shrink-0 ml-auto"></app-language-switcher>
          </li>
          <!-- <li class="px-4 py-2.5 hover:bg-base-300 cursor-pointer flex items-center gap-3 transition-colors"
            (click)="closeMenu()">
            <i class="pi pi-envelope text-content-200"></i> <span class="text-sm font-medium text-content-100">{{
              'NAV.CONTACT' | translate }}</span>
          </li> -->
          <div class="border-t border-base-300 my-1"></div>
          <li
            class="px-4 py-2.5 hover:bg-red-500/10 text-red-500 cursor-pointer flex items-center gap-3 transition-colors"
            (click)="onLogout()">
            <i class="pi pi-sign-out"></i> <span class="text-sm font-medium">{{ 'NAV.LOGOUT' | translate
              }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

<app-confirm-dialog [isOpen]="isDeleteModalOpen" [title]="deleteModalTitle" [message]="deleteModalMessage"
  confirmText="Delete" cancelText="Cancel" [isDestructive]="true" (confirm)="onConfirmDelete()"
  (cancel)="onCancelDelete()">
</app-confirm-dialog>